<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Архив</title>
    
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}" />
    <link rel="icon" type="image/png" href="{% static 'images/Group_2_2.png' %}">
  </head>
  <body>
    <header>
      <nav>
        <ul class="menu-items">
          <li class="menu-item"><a href="{% url 'library' %}">Библиотека</a></li>
          <li class="menu-item"><a href="{% url 'archive' %}">Архив</a></li>
        </ul>
      </nav>
      <a href="{% url 'library' %}">
        <img src="{% static 'images/Group_2_2.png' %}" alt="Логотип" class="logo">
      </a>
      <a href="{% url 'profile' %}" class="profile-link">
        <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NCA2NCI+PGNpcmNsZSBjeD0iMzIiIGN5PSIzMiIgcj0iMzIiIGZpbGw9IiMxNjRkMmUiLz48Y2lyY2xlIGN4PSIzMiIgY3k9IjIyIiByPSI5IiBmaWxsPSIjZjVmY2M2Ii8+PHBhdGggZD0iTTQ4IDUyYzAtOC44MzctNy4xNjMtMTYtMTYtMTZzLTE2IDcuMTYzLTE2IDE2aDMyeiIgZmlsbD0iI2Y1ZmNjNiIvPjwvc3ZnPg==" 
      alt="Профиль" class="profile-icon">
      </a>
    </header>

    <section class="genre-selector">
        <div class="container">
            <h2 class="section-title">Выберите категорию</h2>
            <div class="genres-grid">
                <button class="genre-btn active" data-genre="all">Все статьи</button>
                <button class="genre-btn" data-genre="Технические">Технические</button>
                <button class="genre-btn" data-genre="Медицинские">Медицинские</button>
                <button class="genre-btn" data-genre="Химические">Химические</button>
                <button class="genre-btn" data-genre="Гуманитарные">Гуманитарные</button>
            </div>
        </div>
    </section>

    <main class="content-section">
        <div class="container">
            <div class="books-grid" id="books-container">
                <div class="welcome-message">
                    <h3>Архив научных статей</h3>
                    <p>Выберите категорию чтобы увидеть архивные материалы</p>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
      <p class="footer-copyright">&copy; 2025 Библиотека и архив. Все права защищены.</p>
    </footer>
    <script>
        const articlesData = [
            {% for article in articles %}
            {
              id: {{ article.id }},
              title: "{{ article.title|escapejs }}",
              author: "{{ article.author|escapejs }}",
              description_short: "{{ article.description_short|escapejs }}",
              genre: "{{ article.genre }}"
            }{% if not forloop.last %},{% endif %}
            {% endfor %}
        ];

        function setupArticleCardClicks() {
          document.addEventListener('click', function(event) {
              const articleCard = event.target.closest('.books-card');
              if (articleCard) {
                  const articleId = articleCard.getAttribute('article-article-id');
                  if (articleId) {
                      window.location.href = `/article/${articleId}/`;
                  }
              }
            });
        }

        function displayArticles(genre = 'all') {
            const articlesContainer = document.getElementById('books-container');
            
            const filteredArticles = genre === 'all' 
                ? articlesData 
                : articlesData.filter(article => {
                    const matches = article.genre === genre;
                    return matches;
                });

            if (filteredArticles.length === 0) {
                articlesContainer.innerHTML = `
                    <div class="welcome-message">
                        <h3>Статьи не найдены</h3>
                        <p>Попробуйте выбрать другой жанр</p>
                        <p style="color: #888; margin-top: 10px;">Запрошенный жанр: ${genre}</p>
                    </div>
                `;
                return;
            }

            articlesContainer.innerHTML = filteredArticles.map(article => `
              <a href="/article/${article.id}/" class="book-card-link">
                  <div class="book-card">
                      <h3 class="book-title">${article.title}</h3>
                      <p class="book-author">${article.author}</p>
                      <p class="book-description">${article.description_short}</p>
                      <span class="book-genre">${getGenreDisplay(article.genre)}</span>
                  </div>
              </a>
            `).join('');
        }

        function getGenreDisplay(genre) {
            const genres = {
              'Технические': 'Технические',
              'Медицинские': 'Медицинские',
              'Химические': 'Химические',
              'Гуманитарные': 'Гуманитарные'
            };
            return genres[genre] || genre;
        }

        function setupGenreButtons() {
            const genreButtons = document.querySelectorAll('.genre-btn');
            
            genreButtons.forEach(button => {
                button.addEventListener('click', function() {
                    
                    genreButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    const genre = this.getAttribute('data-genre');
                    displayArticles(genre);
                });
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            setupGenreButtons();
            
            if (articlesData.length > 0) {
                displayArticles('all');
            } else {
                console.log('Нет статей для отображения');
            }
        });
    </script>
  </body>
</html>